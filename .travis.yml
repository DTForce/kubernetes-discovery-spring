language: java

dist: trusty
sudo: false
jdk: openjdk8

jobs:
  include:
    - stage: build
      install: true # Skip gradle assemble
      script: gradle build -x test -x signArchives

    - stage: test
      install: true # Same as in build
      script: gradle check -x signArchives

    - stage: publish
      if: tag IS present
      env:
        - MAVEN_REPO_URL="https://oss.sonatype.org/service/local/staging/deploy/maven2/"
        - secure: "pbZHDPhhxQS/SlEOCcm0j2In0UiX8GKHxemIxGNAMi8bGZVWBG6ymDHaalqs5V2mD6kpAEBke3coT9fX8bowzSYgqU/nfZs7EQvOim2jQ85TUXApzppA2lulLmCrHZckts9eCNEZm0O4Lh3NRyQrdSbPtv2qNfvODwHZlry1qRPemttev0ONpxOdrTYKs/R6VRE36GRuZkQASh2HTu3hqIvuKsCjOhnMwt3+kMTpEo0j5s97aXYOvayahijP7ZpZr2LxYD5mrueNgorsC9EBUJT3q7mb6YnOgbYSUOpbFedSlA6KhhhpqH6ozXQcqWxkSz0zmHcouyJBYJLboKI0MMZoGb4L2hZnKVT7E3+axm7FrXgVxjeu79ppdX4MuhMnZo5ajnQLHxpaOs0AY/AlHfSyjOwamy21JZNdwiT8oabWO8N80fe8W7irQYYVguQtYMcJs1RiJJe0SVj17fHtjowZWYSkOFqcwcPXOqgNMsX5b2T5Wxmdfi5/ex11ceqliVrF734iT32FuBPxAaK8CKDHFcX3+LTNN66e0DroKTF3wu0z6Mv+gcbcmUaBr0ZUcC+y9x1cyNDT72OOLhNY5wyXxyAj/4IKEwI9bHnVP9BsW7uCOsWTv9KuYrj2flRMxKiqFpLBnEIdNbRhhXaq2USXIH1G1wEIm75kwqIKW/Y="
        - secure: "qQ3JoQmpR40hQFoFuk2u8E3SjLEs3WSHFequMtExPRaKhVJpLG41feCxxWNNquaWenIWFjZug0iok8vfnkdvpzODgeYBXb6VHMj+PgRqIzJ+QMzXX7CBfeLENI05jvT/LomD4OFbrAJ2rWFhI6ISWP6WY9jigRCggaJ7uBwhe+lwZZYb0XWq4NvlJa6yvZbn0Y8TqNcBIV5YZeMgKsr57VqpMBZjwjMVvlkUuRsSOpib28aLoMJRy+MxVV/7RedzrC1B4ZIdPx8aZZejJRfzoMPBn5be+Ltl64rTInsF3kup6aY/iYtAdak3V7+muEN/lLdHAkKfYYe8o9K4Hw+PWwYJepK5OsJoDTNq116DSZvHZ33a6mOZJ8ekU10lW5ecnP5Em+I2gyQaHvxx7qN2GkU/y24XOse4oOoTsrmd0F5NWpzaOfD7q1qmc3+L3FJsyShqnXR8Kmm0d8gaKh9lHb57xHyMue1IJMXBWPGuW+3T/XGsQg8lYNQGZ0tpJP5XxQGllcbcDGYiNpjGFx8LjGZYdzMj+M73djU/IYznbflYfaVARAOxqIueSxsZByaGgkMMiN2pGMgKNp5hij9lJlnt/nNVLu5QsshIPhjDtu7EyxuUmrzcOwwAX9e5VhlUvcYyM1XRStVuIU/yymCjnUQt1k+0lTVcGo7f3G6dkUM="
      before_install:
        - openssl aes-256-cbc -K $encrypted_23c9d51bee08_key -iv $encrypted_23c9d51bee08_iv -in ci/ci-secrets.tar.enc -out ci/ci-secrets.tar -d
        - tar xvf ci/ci-secrets.tar -C ./ci
        - mv ci/ci-signing.gradle.properties ./gradle.properties
      install:
        - true # Same as above
      script:
        - gradle uploadArchives

cache:
  directories:
    - ~/.gradle

